{
    "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
    "data": {
        "name": "hydro_eepot_chart"
    },
    "params": [
        {
            "name": "prefix",
            "value": "e",
            "bind": {
                "input": "select",
                "options": [
                    "e",
                    "c",
                    "mv",
                    "lcoe"
                ],
                "labels": [
                    "Energy [GWh]",
                    "Capacity [MW]",
                    "Market Value [€/MWh]",
                    "Levelized Cost of Energy [€/MWh]"
                ],
                "name": "Metric: "
            }
        },
        {
            "name": "suffix",
            "value": "mocc",
            "bind": {
                "input": "select",
                "options": [
                    "mocc",
                    "stcc"
                ],
                "labels": [
                    "Medium Climate Change",
                    "Strong climate Change"
                ],
                "name": "Climate Change:"
            }
        },
        {
            "name": "grid",
            "select": "interval",
            "bind": "scales"
        }
    ],
    "title": "Hydro Energy",
    "transform": [
        {
            "calculate": "datum.id",
            "as": "feature_id"
        },
        {
            "calculate": "datum.abschnitt",
            "as": "feature_name"
        },
        {
            "fold": [
                "e_current",
                "e_technical_potential",
                "c_current",
                "c_technical_potential",
                "e_2070_high_mocc",
                "e_2070_low_mocc",
                "e_2070_medium_mocc",
                "e_2040_high_mocc",
                "e_2040_low_mocc",
                "e_2040_medium_mocc",
                "c_2070_high_mocc",
                "c_2070_low_mocc",
                "c_2070_medium_mocc",
                "c_2040_high_mocc",
                "c_2040_low_mocc",
                "c_2040_medium_mocc",
                "mv_2070_high_mocc",
                "mv_2070_low_mocc",
                "mv_2070_medium_mocc",
                "mv_2040_high_mocc",
                "mv_2040_low_mocc",
                "mv_2040_medium_mocc",
                "lcoe_2070_high_mocc",
                "lcoe_2070_low_mocc",
                "lcoe_2070_medium_mocc",
                "lcoe_2040_high_mocc",
                "lcoe_2040_low_mocc",
                "lcoe_2040_medium_mocc",
                "e_2070_high_stcc",
                "e_2070_low_stcc",
                "e_2070_medium_stcc",
                "e_2040_high_stcc",
                "e_2040_low_stcc",
                "e_2040_medium_stcc",
                "c_2070_high_stcc",
                "c_2070_low_stcc",
                "c_2070_medium_stcc",
                "c_2040_high_stcc",
                "c_2040_low_stcc",
                "c_2040_medium_stcc",
                "mv_2070_high_stcc",
                "mv_2070_low_stcc",
                "mv_2070_medium_stcc",
                "mv_2040_high_stcc",
                "mv_2040_low_stcc",
                "mv_2040_medium_stcc",
                "lcoe_2070_high_stcc",
                "lcoe_2070_low_stcc",
                "lcoe_2070_medium_stcc",
                "lcoe_2040_high_stcc",
                "lcoe_2040_low_stcc",
                "lcoe_2040_medium_stcc"
            ],
            "as": [
                "metric",
                "value"
            ]
        },
        {
            "filter": "test('^' + prefix + '_', datum.metric)"
        },
        {
            "filter": "test('_' + suffix + '$', datum.metric) || indexof(['c_current','c_technical_potential','e_current','e_technical_potential'], datum.metric) >= 0"
        },
        {
            "calculate": "(datum.metric == 'e_current' || datum.metric == 'c_current' || datum.metric == 'mv_current' || datum.metric == 'lcoe_current') ? 1 :(datum.metric == 'e_technical_potential' || datum.metric == 'c_technical_potential' || datum.metric == 'mv_technical_potential' || datum.metric == 'lcoe_technical_potential') ? 998 :((parseInt(split(datum.metric, '_')[1]) == 2070 ? 10 :parseInt(split(datum.metric, '_')[1]) == 2040 ? 20 : 999)+(indexof(['low','medium','high'], split(datum.metric, '_')[2]) + 1))",
            "as": "sort_index"
        }
    ],
    "mark": {
        "type": "bar"
    },
    "encoding": {
        "x": {
            "field": "metric",
            "type": "nominal",
            "sort": {
                "field": "sort_index",
                "order": "ascending"
            },
            "axis": {
                "labelAngle": -45,
                "title": "",
                "labelExpr": "replace(replace(replace(replace(replace(replace(replace(replace(datum.label,'e_', ''), 'mv_', ''), 'c_', ''),'lcoe_', ''),'_wocc',''),'technical_potential','Technical potential'),'technical_potential','current', 'current'),'_',' ')"
            }
        },
        "xOffset": {
            "field": "feature_id",
            "type": "nominal"
        },
        "y": {
            "field": "value",
            "type": "quantitative",
            "axis": {
                "title": "value"
            }
        },
        "color": {
            "field": "feature_name",
            "type": "nominal",
            "title": "Abschnitt",
            "sort": null,
            "scale": {
                "range": [
                    "#1f77b4",
                    "#ff7f0e",
                    "#2ca02c",
                    "#d62728",
                    "#9467bd",
                    "#8c564b",
                    "#e377c2",
                    "#7f7f7f",
                    "#bcbd22",
                    "#17becf"
                ]
            }
        },
        "tooltip": [
            {
                "field": "feature_name"
            },
            {
                "field": "metric"
            },
            {
                "field": "value",
                "type": "quantitative",
                "format": ".1f"
            }
        ]
    },
    "background": "transparent"
}