{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": { "name": "air_eepot_chart" },
  "params": [
    {
      "name": "prefix",
      "value": "e",
      "bind": {
        "input": "select",
        "options": ["e", "c", "mv", "lcoe"],
        "labels": [
          "Energy [GWh]",
          "Capacity [MW]",
          "Market Value [€/MWh]",
          "Levelized Cost of Energy [€/MWh]"
        ],
        "name": "Metric:"
      }
    },
    { "name": "grid", "select": "interval", "bind": "scales" }
  ],
  "title": "Air Source Heat Pump",
  "transform": [
    { "calculate": "datum.id", "as": "feature_id" },
    { "calculate": "datum.name", "as": "feature_name" },
    {
      "fold": [
        "e_2030_high_wocc",
        "e_2030_low_wocc",
        "e_2030_medium_wocc",
        "e_2040_high_wocc",
        "e_2040_low_wocc",
        "e_2040_medium_wocc",
        "e_current",
        "e_technical_potential",
        "c_2030_high_wocc",
        "c_2030_low_wocc",
        "c_2030_medium_wocc",
        "c_2040_high_wocc",
        "c_2040_low_wocc",
        "c_2040_medium_wocc",
        "c_current",
        "c_technical_potential",
        "mv_2030_high_wocc",
        "mv_2030_low_wocc",
        "mv_2030_medium_wocc",
        "mv_2040_high_wocc",
        "mv_2040_low_wocc",
        "mv_2040_medium_wocc",
        "lcoe_2030_high_wocc",
        "lcoe_2030_low_wocc",
        "lcoe_2030_medium_wocc",
        "lcoe_2040_high_wocc",
        "lcoe_2040_low_wocc",
        "lcoe_2040_medium_wocc"
      ],
      "as": ["metric", "value"]
    },
    { "filter": "test('^' + prefix + '_', datum.metric)" },
    {
      "calculate": "(datum.metric == 'e_current' || datum.metric == 'c_current' || datum.metric == 'mv_current' || datum.metric == 'lcoe_current') ? 1 :(datum.metric == 'e_technical_potential' || datum.metric == 'c_technical_potential' || datum.metric == 'mv_technical_potential' || datum.metric == 'lcoe_technical_potential') ? 998 :((parseInt(split(datum.metric, '_')[1]) == 2030 ? 10 :parseInt(split(datum.metric, '_')[1]) == 2040 ? 20 : 999)+(indexof(['low','medium','high'], split(datum.metric, '_')[2]) + 1))",
      "as": "sort_index"
    }
  ],
  "mark": { "type": "bar" },
  "encoding": {
    "x": {
      "field": "metric",
      "type": "nominal",
      "sort": { "field": "sort_index", "order": "ascending" },
      "axis": {
        "labelAngle": 50,
        "title": "",
        "labelExpr": "replace(replace(replace(replace(replace(replace(replace(replace(datum.label,'e_', ''), 'mv_', ''), 'c_', ''),'lcoe_', ''),'_wocc',''),'technical_potential','Technical potential'),'technical_potential','current', 'current'),'_',' ')"
      }
    },
    "xOffset": { "field": "feature_id", "type": "nominal" },
    "y": {
      "field": "value",
      "type": "quantitative",
      "axis": { "title": "value" }
    },
    "color": { "field": "feature_name", "type": "nominal", "title": "feature" },
    "tooltip": [
      { "field": "feature_name", "type": "nominal" },
      { "field": "metric", "type": "nominal" },
      { "field": "value", "type": "quantitative" }
    ]
  }
}
